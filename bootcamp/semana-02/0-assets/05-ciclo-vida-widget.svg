<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 900">
  <!-- Background -->
  <rect width="800" height="900" fill="#1e1e1e"/>
  
  <!-- Title -->
  <text x="400" y="35" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#569cd6" text-anchor="middle">
    Ciclo de Vida de un StatefulWidget
  </text>
  
  <!-- StatefulWidget Section -->
  <g id="stateful-widget-section">
    <rect x="50" y="70" width="700" height="120" rx="8" fill="#252526" stroke="#569cd6" stroke-width="3"/>
    <text x="400" y="95" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#569cd6" text-anchor="middle">
      StatefulWidget (Inmutable)
    </text>
    
    <rect x="100" y="110" width="600" height="65" rx="6" fill="#1e1e1e" stroke="#4ec9b0" stroke-width="2"/>
    <text x="110" y="132" font-family="Consolas, monospace" font-size="12" fill="#c586c0">class</text>
    <text x="145" y="132" font-family="Consolas, monospace" font-size="12" fill="#4ec9b0"> MyWidget </text>
    <text x="220" y="132" font-family="Consolas, monospace" font-size="12" fill="#c586c0">extends</text>
    <text x="275" y="132" font-family="Consolas, monospace" font-size="12" fill="#569cd6"> StatefulWidget </text>
    <text x="410" y="132" font-family="Consolas, monospace" font-size="12" fill="#d4d4d4">{</text>
    
    <text x="120" y="152" font-family="Consolas, monospace" font-size="11" fill="#dcdcaa">  createState</text>
    <text x="200" y="152" font-family="Consolas, monospace" font-size="11" fill="#d4d4d4">() => </text>
    <text x="240" y="152" font-family="Consolas, monospace" font-size="11" fill="#4ec9b0">_MyWidgetState</text>
    <text x="360" y="152" font-family="Consolas, monospace" font-size="11" fill="#d4d4d4">();</text>
    <text x="420" y="152" font-family="Consolas, monospace" font-size="10" fill="#608b4e">  // Se llama solo 1 vez</text>
    
    <text x="110" y="170" font-family="Consolas, monospace" font-size="12" fill="#d4d4d4">}</text>
  </g>
  
  <!-- Arrow down -->
  <line x1="400" y1="190" x2="400" y2="225" stroke="#dcdcaa" stroke-width="3" marker-end="url(#arrow)"/>
  <text x="420" y="213" font-family="Arial, sans-serif" font-size="12" fill="#dcdcaa">createState()</text>
  
  <!-- State Object Section -->
  <g id="state-section">
    <rect x="50" y="225" width="700" height="630" rx="8" fill="#252526" stroke="#c586c0" stroke-width="3"/>
    <text x="400" y="250" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#c586c0" text-anchor="middle">
      State Object (Mutable)
    </text>
    
    <!-- 1. initState() -->
    <g id="init-state">
      <rect x="250" y="270" width="300" height="65" rx="6" fill="#2d2d30" stroke="#4ec9b0" stroke-width="3"/>
      <text x="400" y="290" font-family="Consolas, monospace" font-size="14" font-weight="bold" fill="#4ec9b0" text-anchor="middle">
        1. initState()
      </text>
      <text x="400" y="310" font-family="Arial, sans-serif" font-size="11" fill="#9cdcfe" text-anchor="middle">
        Se ejecuta solo 1 vez al crear el widget
      </text>
      <text x="400" y="325" font-family="Arial, sans-serif" font-size="10" fill="#d4d4d4" text-anchor="middle">
        Inicializar controladores, listeners, datos
      </text>
    </g>
    
    <!-- Arrow down -->
    <line x1="400" y1="335" x2="400" y2="360" stroke="#dcdcaa" stroke-width="2" marker-end="url(#arrow)"/>
    
    <!-- 2. didChangeDependencies() -->
    <g id="did-change-dependencies">
      <rect x="200" y="360" width="400" height="65" rx="6" fill="#2d2d30" stroke="#dcdcaa" stroke-width="2"/>
      <text x="400" y="380" font-family="Consolas, monospace" font-size="13" font-weight="bold" fill="#dcdcaa" text-anchor="middle">
        2. didChangeDependencies()
      </text>
      <text x="400" y="400" font-family="Arial, sans-serif" font-size="11" fill="#9cdcfe" text-anchor="middle">
        Cuando cambian las dependencias heredadas
      </text>
      <text x="400" y="415" font-family="Arial, sans-serif" font-size="10" fill="#d4d4d4" text-anchor="middle">
        InheritedWidget, Theme, MediaQuery...
      </text>
    </g>
    
    <!-- Arrow down -->
    <line x1="400" y1="425" x2="400" y2="450" stroke="#dcdcaa" stroke-width="2" marker-end="url(#arrow)"/>
    
    <!-- 3. build() - MAIN LOOP -->
    <g id="build-method">
      <rect x="230" y="450" width="340" height="75" rx="6" fill="#2d2d30" stroke="#569cd6" stroke-width="4"/>
      <text x="400" y="472" font-family="Consolas, monospace" font-size="14" font-weight="bold" fill="#569cd6" text-anchor="middle">
        3. build(BuildContext context)
      </text>
      <text x="400" y="492" font-family="Arial, sans-serif" font-size="11" fill="#9cdcfe" text-anchor="middle">
        ⚙️ Se ejecuta múltiples veces
      </text>
      <text x="400" y="508" font-family="Arial, sans-serif" font-size="10" fill="#d4d4d4" text-anchor="middle">
        Construye y retorna el árbol de widgets
      </text>
      <text x="400" y="520" font-family="Arial, sans-serif" font-size="10" fill="#4ec9b0" font-weight="bold" text-anchor="middle">
        DEBE ser puro (sin side effects)
      </text>
    </g>
    
    <!-- setState() loop -->
    <path d="M 230 487 Q 120 487 120 620 L 120 630" stroke="#c586c0" stroke-width="3" fill="none" marker-end="url(#arrow-pink)"/>
    <text x="90" y="560" font-family="Consolas, monospace" font-size="12" font-weight="bold" fill="#c586c0" transform="rotate(-90 90 560)">
      setState()
    </text>
    
    <!-- 4. setState() -->
    <g id="set-state">
      <rect x="120" y="630" width="160" height="100" rx="6" fill="#2d2d30" stroke="#c586c0" stroke-width="3"/>
      <text x="200" y="650" font-family="Consolas, monospace" font-size="13" font-weight="bold" fill="#c586c0" text-anchor="middle">
        setState(() {
      </text>
      <text x="200" y="670" font-family="Consolas, monospace" font-size="12" fill="#9cdcfe" text-anchor="middle">
        counter++;
      </text>
      <text x="200" y="690" font-family="Consolas, monospace" font-size="13" font-weight="bold" fill="#c586c0" text-anchor="middle">
        });
      </text>
      <text x="200" y="710" font-family="Arial, sans-serif" font-size="9" fill="#d4d4d4" text-anchor="middle">
        Notifica cambio
      </text>
      <text x="200" y="723" font-family="Arial, sans-serif" font-size="9" fill="#d4d4d4" text-anchor="middle">
        → llama build()
      </text>
    </g>
    
    <!-- Arrow from setState back to build -->
    <path d="M 200 630 L 200 560 L 230 487" stroke="#c586c0" stroke-width="3" fill="none" marker-end="url(#arrow-pink)"/>
    
    <!-- 5. didUpdateWidget() -->
    <g id="did-update-widget">
      <rect x="320" y="650" width="160" height="80" rx="6" fill="#2d2d30" stroke="#dcdcaa" stroke-width="2"/>
      <text x="400" y="670" font-family="Consolas, monospace" font-size="12" font-weight="bold" fill="#dcdcaa" text-anchor="middle">
        didUpdateWidget
      </text>
      <text x="400" y="688" font-family="Consolas, monospace" font-size="11" fill="#dcdcaa" text-anchor="middle">
        (oldWidget)
      </text>
      <text x="400" y="707" font-family="Arial, sans-serif" font-size="10" fill="#9cdcfe" text-anchor="middle">
        Widget padre reconstruye
      </text>
      <text x="400" y="722" font-family="Arial, sans-serif" font-size="10" fill="#9cdcfe" text-anchor="middle">
        con nuevas props
      </text>
    </g>
    
    <!-- Arrow from didUpdateWidget to build -->
    <path d="M 400 650 L 400 525" stroke="#dcdcaa" stroke-width="2" fill="none" marker-end="url(#arrow)"/>
    
    <!-- 6. deactivate() -->
    <g id="deactivate">
      <rect x="520" y="670" width="160" height="60" rx="6" fill="#2d2d30" stroke="#d7ba7d" stroke-width="2"/>
      <text x="600" y="690" font-family="Consolas, monospace" font-size="12" font-weight="bold" fill="#d7ba7d" text-anchor="middle">
        deactivate()
      </text>
      <text x="600" y="710" font-family="Arial, sans-serif" font-size="10" fill="#9cdcfe" text-anchor="middle">
        Widget removido
      </text>
      <text x="600" y="724" font-family="Arial, sans-serif" font-size="10" fill="#9cdcfe" text-anchor="middle">
        del árbol (temporal)
      </text>
    </g>
    
    <!-- Arrow down from build to dispose -->
    <line x1="400" y1="525" x2="400" y2="770" stroke="#f48771" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrow-red)"/>
    <text x="340" y="650" font-family="Arial, sans-serif" font-size="10" fill="#f48771">
      Widget destruido
    </text>
    
    <!-- 7. dispose() -->
    <g id="dispose">
      <rect x="270" y="770" width="260" height="70" rx="6" fill="#2d2d30" stroke="#f48771" stroke-width="3"/>
      <text x="400" y="793" font-family="Consolas, monospace" font-size="14" font-weight="bold" fill="#f48771" text-anchor="middle">
        7. dispose()
      </text>
      <text x="400" y="813" font-family="Arial, sans-serif" font-size="11" fill="#9cdcfe" text-anchor="middle">
        ⚠️ Se ejecuta 1 vez al destruir el widget
      </text>
      <text x="400" y="830" font-family="Arial, sans-serif" font-size="10" fill="#d4d4d4" text-anchor="middle">
        Limpiar controladores, listeners, timers
      </text>
    </g>
  </g>
  
  <!-- Code Example -->
  <g id="code-example">
    <rect x="50" y="870" width="700" height="20" rx="4" fill="#2d2d30"/>
    <text x="70" y="885" font-family="Consolas, monospace" font-size="11" fill="#608b4e">// initState() → build() → setState() → build() → ... → dispose()</text>
  </g>
  
  <!-- Arrow marker definitions -->
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#dcdcaa"/>
    </marker>
    <marker id="arrow-pink" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#c586c0"/>
    </marker>
    <marker id="arrow-red" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#f48771"/>
    </marker>
  </defs>
</svg>
